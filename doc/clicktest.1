.\" -*- mode: troff; coding: utf-8 -*-
.\" Automatically generated by Pod::Man 5.01 (Pod::Simple 3.43)
.\"
.\" Standard preamble:
.\" ========================================================================
.de Sp \" Vertical space (when we can't use .PP)
.if t .sp .5v
.if n .sp
..
.de Vb \" Begin verbatim text
.ft CW
.nf
.ne \\$1
..
.de Ve \" End verbatim text
.ft R
.fi
..
.\" \*(C` and \*(C' are quotes in nroff, nothing in troff, for use with C<>.
.ie n \{\
.    ds C` ""
.    ds C' ""
'br\}
.el\{\
.    ds C`
.    ds C'
'br\}
.\"
.\" Escape single quotes in literal strings from groff's Unicode transform.
.ie \n(.g .ds Aq \(aq
.el       .ds Aq '
.\"
.\" If the F register is >0, we'll generate index entries on stderr for
.\" titles (.TH), headers (.SH), subsections (.SS), items (.Ip), and index
.\" entries marked with X<> in POD.  Of course, you'll have to process the
.\" output yourself in some meaningful fashion.
.\"
.\" Avoid warning from groff about undefined register 'F'.
.de IX
..
.nr rF 0
.if \n(.g .if rF .nr rF 1
.if (\n(rF:(\n(.g==0)) \{\
.    if \nF \{\
.        de IX
.        tm Index:\\$1\t\\n%\t"\\$2"
..
.        if !\nF==2 \{\
.            nr % 0
.            nr F 2
.        \}
.    \}
.\}
.rr rF
.\" ========================================================================
.\"
.IX Title "CLICKTEST 1"
.TH CLICKTEST 1 "" "perl v5.38.2" ""
.\" For nroff, turn off justification.  Always turn off hyphenation; it makes
.\" way too many mistakes in technical documents.
.if n .ad l
.nh
.SH NAME
clicktest \- simple test harness
.SH SYNOPSIS
.IX Header "SYNOPSIS"
clicktest [OPTIONS] [FILE]...
.SH DESCRIPTION
.IX Header "DESCRIPTION"
ClickTest is a simple test harness. A clicktest test comprises a shell
script and, optionally, input and expected output files for that
script. ClickTest runs the script; the test succeeds if all of the script
commands succeed, and the actual output files match expectations.
.PP
ClickTest accepts test filenames and directories as arguments.
Directories are recursively searched for \fI*.clicktest\fR files. It
reports problems for failed tests, plus a summary.
.PP
ClickTest exits with status 0 if all tests succeed, 1 if any test fails,
and 2 if a test fails due to an internal error. Tests whose \fR\f(CB%require\fR\fB\fR
prerequisites fail do not affect the exit status, except that if all
tests' prerequisites fail, the return status is 1 instead of 0.
.SH OPTIONS
.IX Header "OPTIONS"
.IP "\fB\-j\fR\fIN\fR, \fB\-\-jobs\fR=\fIN\fR" 8
.IX Item "-jN, --jobs=N"
Run up to \fIN\fR tests simultaneously. Like Make's \fB\-j\fR option.
.IP \fIVARIABLE\fR=\fIVALUE\fR 8
.IX Item "VARIABLE=VALUE"
Provide an environment variable setting for \fIVARIABLE\fR within the script.
.IP "\fB\-s\fR, \fB\-\-show\fR \fIFILE\fR" 8
.IX Item "-s, --show FILE"
Echo the contents of \fIFILE\fR on completion. \fIFILE\fR should be one of the
filenames specified by \fR\f(CB%file\fR\fB\fR or \fB\fR\f(CB%expect\fR\fB\fR, or \fBstdout\fR or \fBstderr\fR.
Leaves out any ignored lines.
.IP "\fB\-S\fR, \fB\-\-show\-raw\fR \fIFILE\fR" 8
.IX Item "-S, --show-raw FILE"
Like \fB\-\-show\fR, but includes any ignored lines.
.IP \fB\-\-show\-all\fR 8
.IX Item "--show-all"
Calls \fB\-\-show\fR for all filenames specified by any \fR\f(CB%expect\fR\fB\fR, plus \fBstdout\fR
and \fBstderr\fR. Leaves out any ignored lines.
.IP \fB\-\-show\-all\-raw\fR 8
.IX Item "--show-all-raw"
Like \fB\-\-show\-all\fR, but includes any ignored lines.
.IP "\fB\-e\fR, \fB\-\-expand\fR" 8
.IX Item "-e, --expand"
Don't run the given test; instead, expand its files into the current
directory. The script is stored in a file called \fR\f(CI%script\fR\fI\fR.
.IP \fB\-\-preserve\-temporaries\fR 8
.IX Item "--preserve-temporaries"
Preserve temporary test directories. ClickTest runs each test in its own
subdirectory of the current directory. Test directories are named
\&\fIclicktestNNNNN\fR, and are typically removed on test completion.
Examining the contents of a test directory can be useful when
debugging a test.
.IP "\fB\-p\fR, \fB\-\-path\fR \fIDIR\fR" 8
.IX Item "-p, --path DIR"
Prepend \fIDIR\fR to the \f(CW\*(C`PATH\*(C'\fR environment variable before running the
test script.
.IP "\fB\-V\fR, \fB\-\-verbose\fR" 8
.IX Item "-V, --verbose"
Print information to standard error about successful tests as well as
unsuccessful tests.
.IP "\fB\-VV\fR, \fB\-\-superverbose\fR" 8
.IX Item "-VV, --superverbose"
Like \fB\-\-verbose\fR, but use a slightly different format, and
additionally print every test's \fR\f(CB%info\fR\fB\fR section before the test results.
.IP "\fB\-q\fR, \fB\-\-quiet\fR" 8
.IX Item "-q, --quiet"
Don't print information to the terminal while running multiple tests.
.IP "\fB\-v\fR, \fB\-\-version\fR" 8
.IX Item "-v, --version"
Print version number information and exit.
.IP \fB\-\-help\fR 8
.IX Item "--help"
Print help information and exit.
.SH "FILE FORMAT"
.IX Header "FILE FORMAT"
ClickTest test files consist of several sections, each introduced by a line
starting with \fB%\fR. There must be, at least, a \fR\f(CB%script\fR\fB\fR section.
The \fB\fR\f(CB%file\fR\fB\fR and \fB\fR\f(CB%expect\fR\fB\fR sections define input and output files by
name.
.ie n .IP \fR\fB%script\fR\fB\fR 8
.el .IP \fR\f(CB%script\fR\fB\fR 8
.IX Item "%script"
The \fBsh\fR shell script that controls the test. ClickTest will run each
command in sequence. Every command in the script must succeed, with
exit status 0, or the test will fail. Use \fR\f(CB%file\fR\fB\fR sections to define
script input files and \fB\fR\f(CB%expect\fR\fB\fR sections to check script output files
for expected values.
.Sp
The \fR\f(CB%script\fR\fB\fR section can contain subtests. To start a new subtest,
execute a command like \f(CW\*(C`clicktest_subtest\ SECTIONNAME\*(C'\fR. ClickTest will
report the problematic \f(CW\*(C`SECTIONNAME\*(C'\fR when standard output or error
doesn't match an expected value.
.Sp
The script's environment is populated with any \fIVARIABLE\fRs set on the
clicktest command line with \fR\f(BIVARIABLE\fR\fB=\fR\f(BIVALUE\fR\fB\fR syntax. Also, the
\&\fB\fR\f(CB$rundir\fR\fB\fR environment variable is set to the directory in which
clicktest was originally run.
.ie n .IP "\fR\fB%require\fR\fB [\-q]\fR" 8
.el .IP "\fR\f(CB%require\fR\fB [\-q]\fR" 8
.IX Item "%require [-q]"
An \fBsh\fR shell script defining prerequisites that must be satisfied
before the test can run. Every command in the script must succeed, with
exit status 0, for the test to run. Standard output and error are not
checked, however. The \fB\-q\fR flag tells clicktest not to print an error message
if a requirement fails.
.Sp
ClickTest runs the requirement script before creating any other test files.
For example, contents of \fR\f(CB%file\fR\fB\fR sections are not available.
.ie n .IP \fR\fB%info\fR\fB\fR 8
.el .IP \fR\f(CB%info\fR\fB\fR 8
.IX Item "%info"
A short description of the test. In \fB\-\-superverbose\fR mode, the first
paragraph of its contents is printed before the test results.
.ie n .IP \fR\fB%cut\fR\fB\fR 8
.el .IP \fR\f(CB%cut\fR\fB\fR 8
.IX Item "%cut"
This section is ignored. It is intended to comment out obsolete parts of
the test.
.ie n .IP "\fR\fB%file\fR\fB [\-de] [+\fR\f(BILENGTH\fR\fB] \fR\f(BIFILENAME\fR\fB...\fR" 8
.el .IP "\fR\f(CB%file\fR\fB [\-de] [+\fR\f(BILENGTH\fR\fB] \fR\f(BIFILENAME\fR\fB...\fR" 8
.IX Item "%file [-de] [+LENGTH] FILENAME..."
Create an input file for the script. \fIFILENAME\fR can be \fBstdin\fR,
which sets the script's standard input. If \fB+\fR\fILENGTH\fR is provided,
the file data consists of the \fILENGTH\fR bytes following this line;
otherwise, it consists of the data up to the next section. The \fB\-d\fR
flag tells clicktest to delete the first character of each line in the
section. The \fB\-e\fR flag indicates that the section was MIME
Base64\-encoded (see \fBbase64\fR\|(1)); it is decoded before use. To
include a file with lines that start with \fB%\fR (which would normally
start a new section), use \fB\-d\fR and preface each line of the file with
a space, or use \fB\-e\fR.
.ie n .IP "\fR\fB%expect\fR\fB [\-adeiw] [+\fR\f(BILENGTH\fR\fB] \fR\f(BIFILENAME\fR\fB...\fR" 8
.el .IP "\fR\f(CB%expect\fR\fB [\-adeiw] [+\fR\f(BILENGTH\fR\fB] \fR\f(BIFILENAME\fR\fB...\fR" 8
.IX Item "%expect [-adeiw] [+LENGTH] FILENAME..."
Define an expected output file. Differences between the script's
output \fIFILENAME\fR and the contents of the \fR\f(CB%expect\fR\fB\fR section will
cause the test to fail.
.Sp
\&\fIFILENAME\fR can be \fBstdout\fR, for standard output. If \fB+\fR\fILENGTH\fR is
provided, the file data consists of the \fILENGTH\fR bytes following this
line; otherwise, it consists of the data up to the next section.
.Sp
After running the script, clicktest compares the \fIFILENAME\fR generated by
the script with the provided data. The files are compared
line-by-line. ClickTest ignores blank lines, differences in trailing
whitespace, and lines in the script output that match \fR\f(CB%ignore\fR\fB\fR
patterns (see below). The \fB\-w\fR flag causes clicktest to ignore
differences in amount of whitespace within each line.
.Sp
\&\fR\f(CB%expect\fR\fB\fR lines can contain Perl regular expressions, enclosed by two
sets of braces. The \fB\fR\f(CB%expect\fR\fB\fR line
.Sp
.Vb 1
\&    foo{{(bar)?}}
.Ve
.Sp
matches either \f(CW\*(C`foo\*(C'\fR or \f(CW\*(C`foobar\*(C'\fR. The \fB\-i\fR flag makes all such
regular expressions case-insensitive. (Text outside of regular
expressions must match case.)
.Sp
Document an \fR\f(CB%expect\fR\fB\fR line with \f(CW\*(C`{{?comment}}\*(C'\fR blocks. For example:
.Sp
.Vb 1
\&    foo                {{? the sort was in the right order}}
.Ve
.Sp
ClickTest ignores whitespace before and after the \f(CW\*(C`{{?comment}}\*(C'\fR block, and if
the actual output differs from this expected line, it prints the comment in
addition to the line differences.
.Sp
The \fB\-a\fR flag marks this expected output as an alternate. ClickTest will
compare the script's output file with each provided alternate; the
test succeeds if any of the alternates match. The \fB\-d\fR flag behaves
as in \fR\f(CB%file\fR\fB\fR.
.ie n .IP "\fR\fB%expectv\fR\fB [\-ade] [+\fR\f(BILENGTH\fR\fB] \fR\f(BIFILENAME\fR\fB...\fR" 8
.el .IP "\fR\f(CB%expectv\fR\fB [\-ade] [+\fR\f(BILENGTH\fR\fB] \fR\f(BIFILENAME\fR\fB...\fR" 8
.IX Item "%expectv [-ade] [+LENGTH] FILENAME..."
Define a literal expected output file. This behaves like \fR\f(CB%expect\fR\fB\fR,
except that the script's output file must match the provided data
\&\fIexactly\fR: \fB\fR\f(CB%expectv\fR\fB\fR never ignores whitespace differences, does not
treat \f(CW\*(C`{{}}\*(C'\fR blocks as regular expressions, and does not parse
\&\fB\fR\f(CB%ignore\fR\fB\fR patterns.
.ie n .IP "\fR\fB%expectx\fR\fB [\-adiw] [+\fR\f(BILENGTH\fR\fB] \fR\f(BIFILENAME\fR\fB...\fR" 8
.el .IP "\fR\f(CB%expectx\fR\fB [\-adiw] [+\fR\f(BILENGTH\fR\fB] \fR\f(BIFILENAME\fR\fB...\fR" 8
.IX Item "%expectx [-adiw] [+LENGTH] FILENAME..."
Define a regular-expression expected output file. This behaves like
\&\fR\f(CB%expect\fR\fB\fR, except that every line is treated as a regular expression.
\&\f(CW\*(C`{{?comment}}\*(C'\fR blocks are ignored, but other brace pairs are treated
according to the normal regular expression rules.
.ie n .IP "\fR\fB%stdin\fR\fB [\-de] [+\fR\f(BILENGTH\fR\fB]\fR" 8
.el .IP "\fR\f(CB%stdin\fR\fB [\-de] [+\fR\f(BILENGTH\fR\fB]\fR" 8
.IX Item "%stdin [-de] [+LENGTH]"
Same as \fR\f(CB%file\fR\fB stdin\fR.
.ie n .IP "\fR\fB%stdout\fR\fB [\-adeiw] [+\fR\f(BILENGTH\fR\fB]\fR" 8
.el .IP "\fR\f(CB%stdout\fR\fB [\-adeiw] [+\fR\f(BILENGTH\fR\fB]\fR" 8
.IX Item "%stdout [-adeiw] [+LENGTH]"
Same as \fR\f(CB%expect\fR\fB stdout\fR.
.ie n .IP "\fR\fB%stderr\fR\fB [\-adeiw] [+\fR\f(BILENGTH\fR\fB]\fR" 8
.el .IP "\fR\f(CB%stderr\fR\fB [\-adeiw] [+\fR\f(BILENGTH\fR\fB]\fR" 8
.IX Item "%stderr [-adeiw] [+LENGTH]"
Same as \fR\f(CB%expect\fR\fB stderr\fR.
.ie n .IP "\fR\fB%ignorex\fR\fB [\-di] [+\fR\f(BILENGTH\fR\fB] [\fR\f(BIFILENAME\fR\fB]\fR" 8
.el .IP "\fR\f(CB%ignorex\fR\fB [\-di] [+\fR\f(BILENGTH\fR\fB] [\fR\f(BIFILENAME\fR\fB]\fR" 8
.IX Item "%ignorex [-di] [+LENGTH] [FILENAME]"
Each line in the \fR\f(CB%ignorex\fR\fB\fR section is a Perl regular expression. Lines in
the supplied \fIFILENAME\fR that match any of those regular expressions will not
be considered when comparing files with \fB\fR\f(CB%expect\fR\fB\fR data. The regular
expression must match the whole line. \fIFILENAME\fR may be \fBall\fR, in which case
the regular expressions will apply to all \fB\fR\f(CB%expect\fR\fB\fR files. \f(CW\*(C`{{?comment}}\*(C'\fR
blocks are ignored.
.ie n .IP "\fR\fB%ignore\fR\fB\fR, \fB\fR\fB%ignorev\fR\fB [\-adeiw] [+\fR\f(BILENGTH\fR\fB] [\fR\f(BIFILENAME\fR\fB]\fR" 8
.el .IP "\fR\f(CB%ignore\fR\fB\fR, \fB\fR\f(CB%ignorev\fR\fB [\-adeiw] [+\fR\f(BILENGTH\fR\fB] [\fR\f(BIFILENAME\fR\fB]\fR" 8
.IX Item "%ignore, %ignorev [-adeiw] [+LENGTH] [FILENAME]"
Like \fR\f(CB%ignorex\fR\fB\fR, but \fB\fR\f(CB%ignore\fR\fB\fR parses regular expressions only inside
double braces (\f(CW\*(C`{{ }}\*(C'\fR), and \fB\fR\f(CB%ignorev\fR\fB\fR lines must match exactly.
.ie n .IP "\fR\fB%include\fR\fB \fR\f(BIFILENAME\fR\fB\fR" 8
.el .IP "\fR\f(CB%include\fR\fB \fR\f(BIFILENAME\fR\fB\fR" 8
.IX Item "%include FILENAME"
Interpolate the contents of another clicktest file.
.ie n .IP \fR\fB%eot\fR\fB\fR 8
.el .IP \fR\f(CB%eot\fR\fB\fR 8
.IX Item "%eot"
Marks the end of the current test. The rest of the file will be parsed for
additional tests.
.ie n .IP \fR\fB%eof\fR\fB\fR 8
.el .IP \fR\f(CB%eof\fR\fB\fR 8
.IX Item "%eof"
The rest of the file is ignored.
.SH EXAMPLE
.IX Header "EXAMPLE"
This simple clicktest script checks that 'grep \-c' works for a simple output
file.
.PP
.Vb 7
\&  %script
\&  grep \-c B.
\&  %stdin
\&  Bfoo
\&  B
\&  %stdout
\&  1
.Ve
.SH ENVIRONMENT
.IX Header "ENVIRONMENT"
By default, clicktest sets the \f(CW\*(C`LC_ALL\*(C'\fR environment variable to "C"; without
this setting commands like \fBsort\fR have unpredictable effects. To set
\&\f(CW\*(C`LC_ALL\*(C'\fR to another value, set it in the \fR\f(CB%script\fR\fB\fR section.
.SH AUTHOR
.IX Header "AUTHOR"
Eddie Kohler, <kohler@seas.harvard.edu>
